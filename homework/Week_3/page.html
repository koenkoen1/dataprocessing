<!-- Koen Dielhoff, 11269693
Purpose: existance
-->

<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <title>divorceRate</title>
  </head>
  <body>
    <b>Divorce rate for the total population</b>
    <script>
      let fileName = "divorce_rate.json";
      let txtFile = new XMLHttpRequest();
      txtFile.onreadystatechange = function() {
        if (txtFile.readyState === 4 && txtFile.status == 200) {
          let data = parser(txtFile)
          graph(data)
        }
      }
      txtFile.open("GET", fileName);
      txtFile.send();

      function parser(textFile) {
        let data = JSON.parse(textFile.responseText);
        const years = Object.keys(data);
        let dataValues = []
        years.forEach(function(element) {
          dataValues.push(data[element].Value)
        })
        return [years, dataValues]
      }

      function graph(data) {
        let years = data[0]
        let dataValues = data[1]

        let max = Math.ceil(Math.max(...dataValues))
        let min = Math.floor(Math.min(...dataValues))
        let stepSize = 1;
      	let columnSize = 50;
      	let rowSize = 50;
      	let margin = 10;

        let canvas = document.getElementById('myCanvas');
        let ctx = canvas.getContext('2d');
        canvas.height = 500;
        canvas.width = 1000;
        let yScale = (canvas.height - 3 * margin) / (max - min);
        let xScale = (canvas.width - rowSize) / years.length;

        for (i=0;i<=years.length;i=i+2) {
      		let x = i * xScale + rowSize;
      		ctx.fillText(years[i], x - margin, canvas.height - margin);
      		ctx.moveTo(x, margin);
      		ctx.lineTo(x, canvas.height - 2 * margin);
      	}

        let count =  0;
      	for (scale=min;scale<=max;scale = scale + stepSize) {
      		let y = canvas.height - 2 * margin - (yScale * count * stepSize);
      		ctx.fillText(scale, 3 * margin,y + margin / 2);
      		ctx.moveTo(rowSize,y)
      		ctx.lineTo(canvas.width - xScale,y)
      		count++;
      	}
        ctx.stroke();

        ctx.font = "bold 11px sans-serif";
        ctx.rotate(-Math.PI/2);
        ctx.textAlign = "left";
        ctx.fillText("Divorce rate", -4 * columnSize, margin);
        ctx.fillText("(per 1000 marriages and civil unions)", -4 * columnSize, 2 * margin)
        ctx.rotate(Math.PI/2);
        ctx.fillText("Year", canvas.width - columnSize, canvas.height)
        ctx.stroke();

        ctx.translate(rowSize,canvas.height - 2 * margin + min * yScale);
      	ctx.beginPath();
      	ctx.moveTo(0, -dataValues[0] * yScale);
      	for (i=0;i<years.length;i++) {
      		ctx.lineTo(i * xScale, -dataValues[i] * yScale);
      	}
      	ctx.stroke();
      }
    </script>
    <canvas id="myCanvas">
    </canvas>

  </body>
</html>
